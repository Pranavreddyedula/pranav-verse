<!DOCTYPE html>
<html>
<head>
<title>Project Details</title>
<link rel="stylesheet" href="style.css">

<style>
body{background:#071a2f;color:white;font-family:Segoe UI}
header{background:#02142a;padding:18px;font-size:26px}

.card{
    background:#031c3a;
    padding:25px;
    border-radius:14px;
    max-width:700px;
    margin:auto;
    margin-top:30px;
}
button{
    padding:10px 18px;
    margin:8px;
    border:none;
    border-radius:8px;
    background:#5c6cff;
    color:white;
    cursor:pointer;
}
button:hover{background:#6f7dff;}
img{border-radius:14px;margin:15px 0;}
h3{margin-top:25px;}
.footer{text-align:center;margin:40px;opacity:.6}
</style>

<script type="module">

/* üîê LOGIN PROTECTION */
const user = localStorage.getItem("loggedUser");
if(!user){
    alert("Please login first to view project");
    window.location.href = "login.html";
}

/* Firebase */
import { db } from "./js/firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const id = new URLSearchParams(location.search).get("id");

async function loadProject(){

if(!id){
document.getElementById("box").innerHTML="<h2>Invalid project link</h2>";
return;
}

const snap = await getDoc(doc(db,"projects",id));

if(!snap.exists()){
document.getElementById("box").innerHTML="<h2>Project not found</h2>";
return;
}

const p = snap.data();
window.currentProject = p;

document.getElementById("box").innerHTML=`
<div class="card">

<h2>${p.title || "Untitled Project"}</h2>
<p>${p.description || "No description provided"}</p>

<img src="${p.image || 'https://via.placeholder.com/600x300'}" width="100%">

<h3>Project Links</h3>

<a href="${p.github || '#'}" target="_blank">
<button>Source Code</button>
</a>

<a href="${p.live || '#'}" target="_blank">
<button onclick="checkLive(event,'${p.live || ''}')">Live Demo</button>
</a>

<h3>Download Documentation</h3>

<button onclick="downloadPDF()">Download Project Details</button>

<a href="certificate.html?user=${user}&title=${encodeURIComponent(p.title)}">
<button>Get Certificate</button>
</a>

</div>`;
}

/* Prevent empty live demo */
window.checkLive = function(e,link){
if(!link){
e.preventDefault();
alert("Live demo not provided by author");
}
}

/* Download project details */
window.downloadPDF = function(){
let p = window.currentProject;

let text = `
Project : ${p.title}

Description:
${p.description}

Source Code:
${p.github}

Live Demo:
${p.live || "Not Provided"}

Created by Edula Sai Pranav Reddy
`;

let blob=new Blob([text],{type:'text/plain'});
let a=document.createElement('a');
a.href=URL.createObjectURL(blob);
a.download=(p.title || "project")+".txt";
a.click();
}

loadProject();

</script>
</head>

<body>

<header>Project Details</header>
<div class="container" id="box">Loading project...</div>

<div class="footer">Created by Edula Sai Pranav Reddy</div>

</body>
</html>
